setwd("~/forest/Mod_forest")
knitr::opts_chunk$set(echo = FALSE,
warning = FALSE,
message = FALSE)
library(readxl)
library(tidyverse)
library(ggplot2)
data<- read_xlsx("Datos_P2.xlsx")
str(data)
data<- data %>% mutate(Sitio= as.factor(Sitio))
View(data)
str(data)
View(data)
(144*70)/100
set.seed(40)
datam<- data %>% slice(c(sample(101)))
View(datam)
(144*30)/100
datav<- data %>% slice(sample(43))
View(datav)
set.seed(40)
datam<- data %>% slice(c(sample(101)))
datav<- data %>% slice(sample(43))
datav<- data %>% slice(sample(43))
set.seed(40)
datam<- data %>% slice(c(sample(101)))
set.seed(40)
datam<- data %>% slice(c(sample(101)))
set.seed(10)
datam<- data %>% slice(c(sample(101)))
set.seed(200)
datam<- data %>% slice(c(sample(101)))
set.seed(40)
datam<- data %>% slice(c(sample(101)))
set.seed(40)
datav<- data %>% slice(sample(43))
set.seed(40)
col= sample(101)
datam<- data %>% slice(col)
set.seed(40)
Col= sample(43)
datav<- data %>% slice(Col)
col
Col
range(col)
order(col)
sort(col)
sort(Col)
sample(43)
set.seed(40)
col= sample(144, 101)
datam<- data %>% slice(col)
set.seed(40)
Col= sample(144 ,43)
datav<- data %>% slice(Col)
range(col)
range(Col)
sort(col)
sort(Col)
datam<- data %>% slice(col)
datav<- data %>% slice(Col)
names(datam)
mod1<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam)
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam)
a<- shapiro.test(resid(modelo))[2]
round(a,3)
a
a<- shapiro.test(resid)
a<- shapiro.test(resid(modelo))
round(a$p.value, 4)
tabla<- tibble(Modelo= "mod1",
Fc= broom::glance(modelo)$statistic,
valor.p= broom::glance(modelo)$p.value,
Shapiro= round(a$p.value, 4),
R.squared= broom::glance(modelo)$r.squared,
AIC= broom::glance(modelo)$AIC,
RSE= broom::glance(modelo)$sigma)
tabla
modelo<- lm(log(`Altura total (m)`) ~ log(`DAP (cm)`), data = datam)
prueba<- broom::augment(modelo)
names(prueba)
broom::tidy(modelo)
broom::tidy(modelo)
prueba<- prueba %>% mutate(fitted=
exp(((anova(modelo)$"Mean Sq"[2])/2)+1.4690203+0.4469912*log..DAP..cm...)) %>%
mutate(resid= exp(log..DAP..cm...) - fitted)
modelo<- lm(log(`Altura total (m)`) ~ log(`DAP (cm)`), data = datam)
prueba<- broom::augment(modelo)
prueba<- prueba %>% mutate(fitted=
exp(((anova(modelo)$"Mean Sq"[2])/2)+1.4690203+0.4469912*log..DAP..cm...)) %>%
mutate(resid= exp(log..DAP..cm...) - fitted)
RSE <- sqrt(sum(prueba$resid^2, na.rm = TRUE)/summary(modelo)$df[2])
tabla2<- tibble(Modelo= "mod2",
Fc= broom::glance(modelo)$statistic,
valor.p= broom::glance(modelo)$p.value,
Shapiro= round(a$p.value, 4),
R.squared= broom::glance(modelo)$r.squared,
AIC= broom::glance(modelo)$AIC,
RSE= round(RSE, 4))
prueba<- prueba %>% mutate(fitted=
exp(((anova(modelo)$"Mean Sq"[2])/2)+1.4690203+0.4469912*log..DAP..cm...)) %>%
mutate(resid= fitted - exp(log..Altura.total..m...))
RSE <- sqrt(sum(prueba$resid^2, na.rm = TRUE)/summary(modelo)$df[2])
tabla2<- tibble(Modelo= "mod2",
Fc= broom::glance(modelo)$statistic,
valor.p= broom::glance(modelo)$p.value,
Shapiro= round(a$p.value, 4),
R.squared= broom::glance(modelo)$r.squared,
AIC= broom::glance(modelo)$AIC,
RSE= round(RSE, 4))
modelo<- lm(log(`Altura total (m)`) ~ log(`DAP (cm)`) + I((log(`DAP (cm)`))^2), data = datam)
prueba<- broom::augment(modelo)
broom::tidy(modelo)
+0.395973547*log..DAP..cm... +
0.009502094*(log..DAP..cm...)^2)) %>%
+0.395973547*log..DAP..cm...+
0.009502094*(log..DAP..cm...)^2)) %>%
+0.395973547*log..DAP..cm...+
0.009502094*(log..DAP..cm...)^2)) %>%
broom::tidy(modelo)
+0.395973547*(log..DAP..cm...)+
0.009502094*(log..DAP..cm...)^2)) %>%
+0.395973547*(log..DAP..cm...))) %>%
broom::tidy(modelo)
prueba<- prueba %>% mutate(fitted=
exp(((anova(modelo)$"Mean Sq"[2])/2)+1.534780445	+0.395973547	*log..DAP..cm... + 0.009502094* log..DAP..cm...^2)) %>%
mutate(resid= fitted - exp(log..Altura.total..m...))
RSE <- sqrt(sum(prueba$resid^2, na.rm = TRUE)/summary(modelo)$df[2])
tabla2<- tibble(Modelo= "mod3",
Fc= broom::glance(modelo)$statistic,
valor.p= broom::glance(modelo)$p.value,
Shapiro= round(a$p.value, 4),
R.squared= broom::glance(modelo)$r.squared,
AIC= broom::glance(modelo)$AIC,
RSE= round(RSE, 4))
start<- nls(`Altura total (m)` ~ SSmicmen(`DAP (cm)`, a, b))
start<- nls(`Altura total (m)` ~ SSmicmen(`DAP (cm)`, a, b), data = datam)
summary(start)
modelo<- nls(`Altura total (m)` ~ a*`DAP (cm)`/(b+`DAP (cm)`), data = datam,
start = list(a= 30.539 , b= 14.856))
summary(modelo)
broom::tidy(modelo)
broom::glance(modelo)
tabla4<- tibble(Modelo= "mod4",
Fc= "",
valor.p= "***",
Shapiro= "",
R.squared= "",
AIC= broom::glance(modelo)$AIC,
RSE= broom::glance(modelo)$sigma)
start<- nls(`Altura total (m)` ~ weibfn(`DAP (cm)`, a, b, c), data = datam)
names(datam)
modelo<- nls(`Altura total (m)` ~ a*(1-exp(-b*`DAP (cm)`^2)), data = datam,
start = list(a= 50 , b= 0.05, c= 1))
modelo<- nls(`Altura total (m)` ~ a*(1-exp(-b*`DAP (cm)`^c)), data = datam,
start = list(a= 50 , b= 0.05, c= 1))
modelo<- nls(`Altura total (m)` ~ a*(1-exp(-b*`DAP (cm)`^c)), data = datam,
start = list(a= 50 , b= 0.05, c= 1),
control = list (maxiter = 500))
modelo<- nls(`Altura total (m)` ~ a*(1-exp(-b*`DAP (cm)`^c)), data = datam,
start = list(a= 50 , b= 0.05, c= 1),
control = list (maxiter = 100))
modelo<- nls(`Altura total (m)` ~ a*(1-exp(-b*`DAP (cm)`^c)), data = datam,
start = list(a= 50 , b= 0.05, c= 1),
control = list (maxiter = 70))
modelo<- nls(`Altura total (m)` ~ a*(1-exp(-b*`DAP (cm)`^c)), data = datam,
start = list(a= 50 , b= 0.05, c= 1),
control = list (maxiter = 60))
modelo<- nls(`Altura total (m)` ~ a*(1-exp(-b*`DAP (cm)`^c)), data = datam,
start = list(a= 50 , b= 0.05, c= 1),
control = list (maxiter = 70))
modelo<- nls(`Altura total (m)` ~ a*(1-exp(-b*`DAP (cm)`^c)), data = datam,
start = list(a= 50 , b= 0.09, c= 1),
control = list (maxiter = 70))
modelo<- nls(`Altura total (m)` ~ a*(1-exp(-b*`DAP (cm)`^c)), data = datam,
start = list(a= 60 , b= 0.09, c= 2),
control = list (maxiter = 70))
modelo<- nls(`Altura total (m)` ~ a*(1-exp(-b*`DAP (cm)`^c)), data = datam,
start = list(a= 50 , b= 0.09, c= 2),
control = list (maxiter = 70))
modelo<- nls(`Altura total (m)` ~ a*(1-exp(-b*`DAP (cm)`^c)), data = datam,
start = list(a= 50 , b= 0.04, c= 1),
control = list (maxiter = 70))
modelo<- nls(`Altura total (m)` ~ a*(1-exp(-b*`DAP (cm)`^c)), data = datam,
start = list(a= 50 , b= 0.05, c= 1),
control = list (maxiter = 70))
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam)
a<- shapiro.test(resid(modelo))
tabla<- tibble(Modelo= "mod1",
Fc= broom::glance(modelo)$statistic,
valor.p= broom::glance(modelo)$p.value,
Shapiro= round(a$p.value, 4),
R.squared= broom::glance(modelo)$r.squared,
AIC= broom::glance(modelo)$AIC,
RSE= broom::glance(modelo)$sigma)
modelo<- lm(log(`Altura total (m)`) ~ log(`DAP (cm)`), data = datam)
prueba<- broom::augment(modelo)
prueba<- prueba %>% mutate(fitted=
exp(((anova(modelo)$"Mean Sq"[2])/2)+1.4690203+0.4469912*log..DAP..cm...)) %>%
mutate(resid= fitted - exp(log..Altura.total..m...))
RSE <- sqrt(sum(prueba$resid^2, na.rm = TRUE)/summary(modelo)$df[2])
tabla2<- tibble(Modelo= "mod2",
Fc= broom::glance(modelo)$statistic,
valor.p= broom::glance(modelo)$p.value,
Shapiro= round(a$p.value, 4),
R.squared= broom::glance(modelo)$r.squared,
AIC= broom::glance(modelo)$AIC,
RSE= round(RSE, 4))
modelo<- lm(log(`Altura total (m)`) ~ log(`DAP (cm)`) + I((log(`DAP (cm)`))^2), data = datam)
prueba<- broom::augment(modelo)
prueba<- prueba %>% mutate(fitted=
exp(((anova(modelo)$"Mean Sq"[2])/2)+1.534780445	+0.395973547	*log..DAP..cm... + 0.009502094* log..DAP..cm...^2)) %>%
mutate(resid= fitted - exp(log..Altura.total..m...))
RSE <- sqrt(sum(prueba$resid^2, na.rm = TRUE)/summary(modelo)$df[2])
broom::tidy(modelo)
tabla3<- tibble(Modelo= "mod3",
Fc= broom::glance(modelo)$statistic,
valor.p= broom::glance(modelo)$p.value,
Shapiro= round(a$p.value, 4),
R.squared= broom::glance(modelo)$r.squared,
AIC= broom::glance(modelo)$AIC,
RSE= round(RSE, 4))
start<- nls(`Altura total (m)` ~ SSmicmen(`DAP (cm)`, a, b), data = datam)
modelo<- nls(`Altura total (m)` ~ a*`DAP (cm)`/(b+`DAP (cm)`), data = datam,
start = list(a= 30.539 , b= 14.856))
tabla4<- tibble(Modelo= "mod4",
Fc= "",
valor.p= "***",
Shapiro= "",
R.squared= "",
AIC= broom::glance(modelo)$AIC,
RSE= broom::glance(modelo)$sigma)
broom::tidy(modelo)
knitr::kable(cbind(tabla, tabla2, tabla3, tabla4), caption = "Modelos ajustados")
cbind(tabla, tabla2, tabla3, tabla4)
rbind(tabla, tabla2, tabla3, tabla4)
par(mfrow= c(2,2))
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam)
plot(modelo)
par(mfrow= c(2,2))
plot(modelo)
modelo<- lm(log(`Altura total (m)`) ~ log(`DAP (cm)`), data = datam)
par(mfrow= c(2,2))
plot(modelo)
str(datam)
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam[-c(68, 24, 76)])
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam[-c(68, 24, 76)])
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam[-c(68, 24)])
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam[-c(68, 24, 76), ])
summary(modelo)
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam)
modelo1<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam[-c(68, 24, 76), ])
summary(modelo1)
summary(modelo)
anova(modelo)
anova(modelo1)
anova(modelo)
shapiro.test(resid(modelo1))
broom::glance(modelo1)
par(mfrow= c(2,2))
plot(modelo)
View(datam)
max(datam$`DAP (cm)`)
par(mfrow= c(2,2))
plot(modelo1)
anova(modelo)
anova(modelo1)
broom::glance(modelo1)
broom::glance(modelo)
broom::glance(modelo1)
rbind(broom::glance(modelo1), broom::glance(modelo))
rbind(broom::glance(modelo1)$sigma, broom::glance(modelo)$sigma,
broom::glance(modelo1)$AIC, broom::glance(modelo)$AIC)
cbind(broom::glance(modelo1)$sigma, broom::glance(modelo)$sigma,
broom::glance(modelo1)$AIC, broom::glance(modelo)$AIC)
knitr::kable(broom::glance(modelo))
broom::glance(modelo)
rbind(broom::glance(modelo), broom::glance(modelo1))
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam)
ggplot(data = datam, mapping = aes(x= `DAP (cm)`, y= `Altura total (m)`)) +
geom_point()
broom::augment(modelo)
ggplot(data = datam, mapping = aes(x= `DAP (cm)`, y= `Altura total (m)`)) +
geom_point() + geom_smooth(data= broom::augment(modelo), mapping = aes(x= DAP..cm.,
y= .fitted ))
modelo<- lm(log(`Altura total (m)`) ~ log(`DAP (cm)`), data = datam)
prueba<- broom::augment(modelo)
prueba<- prueba %>% mutate(fitted=
exp(((anova(modelo)$"Mean Sq"[2])/2)+1.4690203+0.4469912*log..DAP..cm...)) %>%
mutate(resid= fitted - exp(log..Altura.total..m...))
names(prueba)
ggplot(data = datam, mapping = aes(x= `DAP (cm)`, y= `Altura total (m)`)) +
geom_point() + geom_smooth(data= prueba, mapping = aes(x= exp(log..DAP..cm...),
y= fitted ))
start<- nls(`Altura total (m)` ~ SSmicmen(`DAP (cm)`, a, b), data = datam)
modelo<- nls(`Altura total (m)` ~ a*`DAP (cm)`/(b+`DAP (cm)`), data = datam,
start = list(a= 30.539 , b= 14.856))
broom::augment(modelo)
ggplot(data = datam, mapping = aes(x= `DAP (cm)`, y= `Altura total (m)`)) +
geom_point() + geom_smooth(data= broom::augment(modelo), mapping = aes(x= DAP..cm.,
y= .fitted ))
start<- nls(`Altura total (m)` ~ SSmicmen(`DAP (cm)`, a, b), data = datam)
modelo<- nls(`Altura total (m)` ~ a*`DAP (cm)`/(b+`DAP (cm)`), data = datam,
start = list(a= 30.539 , b= 14.856))
broom::tidy(modelo)
val<- datav %>% mutate(fitted= 30.539*`DAP (cm)`/(14.856+`DAP (cm)`)) %>%
mutate(error= (fitted - `Altura total (m)`)/`Altura total (m)`)*100 %>%
summarise(Media= mean(error), sd= sd(error))
val<- datav %>% mutate(fitted= 30.539*`DAP (cm)`/(14.856+`DAP (cm)`)) %>%
mutate(error= (fitted - `Altura total (m)`)/`Altura total (m)`)*100
View(val)
mean(val$error)
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam)
broom::tidy(modelo)
mean(val$error)
broom::tidy(modelo)
mean(val1$error)
start<- nls(`Altura total (m)` ~ SSmicmen(`DAP (cm)`, a, b), data = datam)
modelo<- nls(`Altura total (m)` ~ a*`DAP (cm)`/(b+`DAP (cm)`), data = datam,
start = list(a= 30.539 , b= 14.856))
val<- datav %>% mutate(fitted= 30.539*`DAP (cm)`/(14.856+`DAP (cm)`)) %>%
mutate(error= ((fitted - `Altura total (m)`)/`Altura total (m)`)*100)
mean(val$error)
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam)
val1<- datav %>% mutate(fitted= 8.47586702 + 0.37981066*`DAP (cm)`+ 0.00079334*`DAP (cm)`^2) %>%
mutate(error= ((fitted - `Altura total (m)`)/`Altura total (m)`)*100)
mean(val1$error)
sd(val$error)
sd(val1$error)
knitr::kable(tibble(Modelo= c("Michaelis-menten", "Lineal cuadratico"),
`%error media`= c(mean(val$error), mean(val1$error)),
`%error sd` = c(sd(val$error), sd(val1$error))))
modelo<- lm(log(`Altura total (m)`) ~ log(`DAP (cm)`), data = datam)
broom::tidy(modelo)
exp(((anova(modelo)$"Mean Sq"[2])/2)+1.4690203)
modelo<- lm(log(`Altura total (m)`) ~ log(`DAP (cm)`), data = datam)
broom::tidy(modelo)
exp(((anova(modelo)$"Mean Sq"[2])/2)+1.4690203)
tabla2<- tibble(Modelo= "$H= 4.448099+0.4469912* DAP$",
Fc= broom::glance(modelo)$statistic,
valor.p= broom::glance(modelo)$p.value,
Shapiro= round(a$p.value, 4),
R.squared= broom::glance(modelo)$r.squared,
AIC= broom::glance(modelo)$AIC,
RSE= round(RSE, 4))
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam)
broom::tidy(modelo)
tabla<- tibble(Modelo= "8.47586702+DAP*0.37981066+DAP^2*0.00079334",
Fc= round(broom::glance(modelo)$statistic, 4),
valor.p= round(broom::glance(modelo)$p.value, 4),
Shapiro= round(a$p.value, 4),
R.squared= round(broom::glance(modelo)$r.squared, 4),
AIC= broom::glance(modelo)$AIC,
RSE= broom::glance(modelo)$sigma)
tabla2<- tibble(Modelo= "$H= 4.448099+0.4469912* DAP$",
Fc= round(broom::glance(modelo)$statistic, 4),
valor.p= round(broom::glance(modelo)$p.value, 4),
Shapiro= round(a$p.value, 4),
R.squared= round(broom::glance(modelo)$r.squared, 4),
AIC= broom::glance(modelo)$AIC,
RSE= round(RSE, 4))
modelo<- lm(log(`Altura total (m)`) ~ log(`DAP (cm)`) + I((log(`DAP (cm)`))^2), data = datam)
broom::tidy(modelo)
exp(((anova(modelo)$"Mean Sq"[2])/2)+1.534780445)
exp(((anova(modelo)$"Mean Sq"[2])/2)+1.534780445)
(anova(modelo)$"Mean Sq"[2])/2)+1.534780445
(anova(modelo)$"Mean Sq"[2])/2)+1.534780445)
(anova(modelo)$"Mean Sq"[2])/2)+1.534780445
((anova(modelo)$"Mean Sq"[2])/2)+1.534780445
exp(1.53)
tabla3<- tibble(Modelo= "$H= exp(1.535255+ln(DAP)*0.395973547+ln(DAP)^2*0.009502094)$",
Fc= round(broom::glance(modelo)$statistic, 4),
valor.p= round(broom::glance(modelo)$p.value, 4),
Shapiro= "",
R.squared= round(broom::glance(modelo)$r.squared, 4),
AIC= broom::glance(modelo)$AIC,
RSE= round(RSE, 4))
start<- nls(`Altura total (m)` ~ SSmicmen(`DAP (cm)`, a, b), data = datam)
modelo<- nls(`Altura total (m)` ~ a*`DAP (cm)`/(b+`DAP (cm)`), data = datam,
start = list(a= 30.539 , b= 14.856))
broom::tidy(modelo)
tabla4<- tibble(Modelo= "H= 30.539*DAP/(14.856+DAP)",
Fc= "",
valor.p= "***",
Shapiro= "",
R.squared= "",
AIC= broom::glance(modelo)$AIC,
RSE= broom::glance(modelo)$sigma)
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam)
summary(modelo)
anova(modelo)
modelo<- lm(log(`Altura total (m)`) ~ log(`DAP (cm)`), data = datam)
anova(modelo)
modelo<- lm(log(`Altura total (m)`) ~ log(`DAP (cm)`) + I((log(`DAP (cm)`))^2), data = datam)
anova(modelo)
start<- nls(`Altura total (m)` ~ SSmicmen(`DAP (cm)`, a, b), data = datam)
modelo<- nls(`Altura total (m)` ~ a*`DAP (cm)`/(b+`DAP (cm)`), data = datam,
start = list(a= 30.539 , b= 14.856))
anova(modelo)
summary(modelo)
modelo<- lm(`Altura total (m)` ~ `DAP (cm)` + I(`DAP (cm)`^2), data = datam)
a<- shapiro.test(resid(modelo))
tabla<- tibble(Modelo= "H= 8.476+DAP*
0.380+DAP^2*0.00079",
Fc= round(broom::glance(modelo)$statistic, 4),
valor.p= "***"),
knitr::kable(rbind(tabla, tabla2, tabla3, tabla4), caption = "Modelos ajustados",
format = "latex", digits = 2, align = "l")
knitr::kable(rbind(tabla, tabla2, tabla3, tabla4), caption = "Modelos ajustados",
format = "latex", digits = 2, align = "l")
